<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一名理智的詹黑">
<meta property="og:type" content="website">
<meta property="og:title" content="怒吃树的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="怒吃树的博客">
<meta property="og:description" content="一名理智的詹黑">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Roger Meng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>怒吃树的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">怒吃树的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">好好学习，天天向上</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/31/Leetcode-1114-Print-In-Order/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/Leetcode-1114-Print-In-Order/" class="post-title-link" itemprop="url">Leetcode-1114-Print-In-Order</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-12-31 11:42:51 / Modified: 12:23:13" itemprop="dateCreated datePublished" datetime="2020-12-31T11:42:51+08:00">2020-12-31</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><p>我们提供了一个类：</p>
<p>public class Foo {<br>  public void first() { print(“first”); }<br>  public void second() { print(“second”); }<br>  public void third() { print(“third”); }<br>}<br>三个不同的线程将会共用一个 Foo 实例。</p>
<p>线程 A 将会调用 first() 方法<br>线程 B 将会调用 second() 方法<br>线程 C 将会调用 third() 方法<br>请设计修改程序，以确保 second() 方法在 first() 方法之后被执行，third() 方法在 second() 方法之后被执行。<br>示例 1:<br>输入: <a href="">1,2,3</a><br>输出: “firstsecondthird”<br>解释:<br>有三个线程会被异步启动。<br>输入 <a href="">1,2,3</a> 表示线程 A 将会调用 first() 方法，线程 B 将会调用 second() 方法，线程 C 将会调用 third() 方法。<br>正确的输出是 “firstsecondthird”。<br>示例 2:<br>输入: <a href="">1,3,2</a><br>输出: “firstsecondthird”<br>解释:<br>输入 <a href="">1,3,2</a> 表示线程 A 将会调用 first() 方法，线程 B 将会调用 third() 方法，线程 C 将会调用 second() 方法。<br>正确的输出是 “firstsecondthird”。<br>提示：<br>尽管输入中的数字似乎暗示了顺序，但是我们并不保证线程在操作系统中的调度顺序。<br>你看到的输入格式主要是为了确保测试的全面性。</p>
<p>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/print-in-order">https://leetcode-cn.com/problems/print-in-order</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
<h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><p>刷Leetcode又换回java了，感觉还是java提供的基础数据结构更加丰富，不足是java写UT真心没有Golang方便，这里分享一个非常好用的Java刷LC的<a target="_blank" rel="noopener" href="https://github.com/helloShen/leetcode-helper" title="代码框架">工具</a>，支持一键生成Solution和UT的代码骨架，让你专注于实现算法逻辑。<br>回到这道题，easy的题目有很多宝藏啊，这道题一道题可以练习不少多线程的相关知识，这里总结几种解题思路。</p>
<h2 id="Semaphore信号量"><a href="#Semaphore信号量" class="headerlink" title="Semaphore信号量"></a>Semaphore信号量</h2><p>利用两个信号量保证并发调用顺序</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    Semaphore two;</span><br><span class="line">    Semaphore three;</span><br><span class="line"></span><br><span class="line">    public Foo() &#123;</span><br><span class="line">        two = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">        three = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> first(Runnable printFirst) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printFirst.run() outputs &quot;first&quot;. Do not change or remove this line.</span></span><br><span class="line">        printFirst.run();</span><br><span class="line">        two.release();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> second(Runnable printSecond) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printSecond.run() outputs &quot;second&quot;. Do not change or remove this line.</span></span><br><span class="line">        two.acquire();</span><br><span class="line">        printSecond.run();</span><br><span class="line">        three.release();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> third(Runnable printThird) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printThird.run() outputs &quot;third&quot;. Do not change or remove this line.</span></span><br><span class="line">        three.acquire();</span><br><span class="line">        printThird.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h2><p>利用CountDownLatch计数保证并发访问，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    CountDownLatch c2;</span><br><span class="line">    CountDownLatch c3;</span><br><span class="line"></span><br><span class="line">    public Foo() &#123;</span><br><span class="line">        c2 = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">        c3 = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> first(Runnable printFirst) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printFirst.run() outputs &quot;first&quot;. Do not change or remove this line.</span></span><br><span class="line">        printFirst.run();</span><br><span class="line">        c2.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> second(Runnable printSecond) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printSecond.run() outputs &quot;second&quot;. Do not change or remove this line.</span></span><br><span class="line">        c2.await();</span><br><span class="line">        printSecond.run();</span><br><span class="line">        c3.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> third(Runnable printThird) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printThird.run() outputs &quot;third&quot;. Do not change or remove this line.</span></span><br><span class="line">        c3.await();</span><br><span class="line">        printThird.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="阻塞队列"><a href="#阻塞队列" class="headerlink" title="阻塞队列"></a>阻塞队列</h2><p>利用阻塞队列放入令牌的方式控制访问顺序。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    BlockingQueue blockingQueue1;</span><br><span class="line">    BlockingQueue blockingQueue2;</span><br><span class="line"></span><br><span class="line">    public Foo() &#123;</span><br><span class="line">        blockingQueue1 = <span class="keyword">new</span> SynchronousQueue();</span><br><span class="line">        blockingQueue2 = <span class="keyword">new</span> SynchronousQueue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> first(Runnable printFirst) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printFirst.run() outputs &quot;first&quot;. Do not change or remove this line.</span></span><br><span class="line">        printFirst.run();</span><br><span class="line">        blockingQueue1.put(<span class="string">&quot;Go&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> second(Runnable printSecond) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printSecond.run() outputs &quot;second&quot;. Do not change or remove this line.</span></span><br><span class="line">        blockingQueue1.take();</span><br><span class="line">        printSecond.run();</span><br><span class="line">        blockingQueue2.put(<span class="string">&quot;Go&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">void</span> third(Runnable printThird) throws InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// printThird.run() outputs &quot;third&quot;. Do not change or remove this line.</span></span><br><span class="line">        blockingQueue2.take();</span><br><span class="line">        printThird.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><p>一题多解，对于实践JUC包中的各种数据结构非常有帮助，很有价值的一道题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/05/Leetcode-Go-350-IntersectionOfTwoArraysII/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/05/Leetcode-Go-350-IntersectionOfTwoArraysII/" class="post-title-link" itemprop="url">Leetcode-Go-350-Intersection-Of-Two-Arrays-II</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-05 15:58:00" itemprop="dateCreated datePublished" datetime="2020-11-05T15:58:00+08:00">2020-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 12:21:43" itemprop="dateModified" datetime="2020-12-31T12:21:43+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><blockquote>
<p>给定两个数组，编写一个函数来计算它们的交集。<br>示例 1：<br>输入：nums1 = [1,2,2,1], nums2 = [2,2]<br>输出：[2,2]<br>示例 2:<br>输入：nums1 = [4,9,5], nums2 = [9,4,9,8,4]<br>输出：[4,9]<br>说明：<br>输出结果中每个元素出现的次数，应与元素在两个数组中出现次数的最小值一致。<br>我们可以不考虑输出结果的顺序。<br>进阶：<br>如果给定的数组已经排好序呢？你将如何优化你的算法？<br>如果 nums1 的大小比 nums2 小很多，哪种方法更优？<br>如果 nums2 的元素存储在磁盘上，内存是有限的，并且你不能一次加载所有的元素到内存中，你该怎么办？<br>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/intersection-of-two-arrays-ii">https://leetcode-cn.com/problems/intersection-of-two-arrays-ii</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
</blockquote>
<h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><p>一道很简单的题目，不过我觉得后面的进阶还蛮有意思的，这道题无非就是两种思路：</p>
<ol>
<li>哈希表，k为nums1或者nums2中的数组元素，v为在对应数组的出现次数，构建完哈希表遍历另一个数组，遇到交集元素value-1，value为0或者k不存在则跳过。</li>
<li>排序数组+双指针，利用排序好的数组和初始化两个指针位于各自数组的起始位置，根据指针对应元素的大小进行指针移动，直到其中一个指针移动到数组末尾。</li>
</ol>
<h2 id="思路一："><a href="#思路一：" class="headerlink" title="思路一："></a>思路一：</h2><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>不妨假设数组长度分别为m,n<br>时间复杂度：O(m+n)，分别遍历两个数组一次。<br>空间复杂度：O(min(m,n))，取较小的数组构建哈希表。</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">func intersect(nums1 []int, nums2 []int) []int &#123;</span><br><span class="line">	m := make(map[int]int)</span><br><span class="line">	<span class="keyword">for</span> _, <span class="attr">v</span> := range nums1 &#123;</span><br><span class="line">		m[v]++</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> ret []int</span><br><span class="line">	<span class="keyword">for</span> _, <span class="attr">v</span> := range nums2 &#123;</span><br><span class="line">		<span class="keyword">if</span> cnt, <span class="attr">ok</span> := m[v]; ok &#123;</span><br><span class="line">			<span class="keyword">if</span> cnt &gt; <span class="number">0</span> &#123;</span><br><span class="line">				ret = append(ret, v)</span><br><span class="line">				m[v]--</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="思路二："><a href="#思路二：" class="headerlink" title="思路二："></a>思路二：</h2><h3 id="复杂度分析-1"><a href="#复杂度分析-1" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>不妨假设数组长度分别为m,n<br>时间复杂度：如果两个数组有序，则复杂度为O(max(m,n))，若数组无序，则时间复杂度就是排序的时间复杂度，即O(nlogn+mlogm)。<br>空间复杂度：O(min(m,n))，返回结果数组的大小。</p>
<h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><p>回到进阶的问题</p>
<ul>
<li>如果给定的数组已经排好序呢？<br>使用思路二的方法。</li>
<li>如果 nums2 的元素存储在磁盘上，内存是有限的，并且你不能一次加载所有的元素到内存中，你该怎么办？<br>使用思路一，把nums1构建哈希表，逐段加载nums2到内存进行判断。</li>
<li>如果 nums1 的大小比 nums2 小很多，哪种方法更优？<br>用nums1构建哈希表，遍历nums2进行匹配。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/29/Leetcode-Go-739-DailyTemperature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/29/Leetcode-Go-739-DailyTemperature/" class="post-title-link" itemprop="url">Leetcode-Go-739-Daily-Temperature</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-29 14:07:30" itemprop="dateCreated datePublished" datetime="2020-10-29T14:07:30+08:00">2020-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 12:21:32" itemprop="dateModified" datetime="2020-12-31T12:21:32+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><blockquote>
<p>请根据每日 气温 列表，重新生成一个列表。对应位置的输出为：要想观测到更高的气温，至少需要等待的天数。如果气温在这之后都不会升高，请在该位置用 0 来代替。</p>
<p>例如，给定一个列表 temperatures = <a href="">73, 74, 75, 71, 69, 72, 76, 73</a>，你的输出应该是 <a href="">1, 1, 4, 2, 1, 1, 0, 0</a>。</p>
<p>提示：气温 列表长度的范围是 <a href="">1, 30000</a>。每个气温的值的均为华氏度，都是在 <a href="">30, 100</a> 范围内的整数。</p>
<p>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/daily-temperatures">https://leetcode-cn.com/problems/daily-temperatures</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
</blockquote>
<h1 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h1><p>题目可归纳为如下问题：<br>对于i,j(I&lt;j)，寻找min(j-i)，且满足T[I]&lt;T[j]</p>
<h2 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h2><p>既然温度满足30-100这个条件，我们可以构造一个大小为100的数组，索引温度下存储该温度对应的最小天数（原数组的最小索引）。遍历数组时，寻找大于当前温度的第一个存在的索引取差值即为所求。<br>时间复杂度：O(mn) m在此题中为100。<br>空间复杂度：O(m) 额外的数组开销。</p>
<h2 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h2><p>维护一个存储数组下标的单调递减栈，遍历数组时，当新元素大于栈顶元素时，说明栈顶元素找到了离它最近的温度更高的下标，弹出栈顶元素并对结果数组赋值；若新元素小于等于栈顶元素，直接将新元素入栈即可。<br>时间复杂度：O(n)<br>空间复杂度：O(n)<br>代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func dailyTemperatures(T []int) []int &#123;</span><br><span class="line">	ret := make([]int, len(T))</span><br><span class="line">	<span class="keyword">var</span> stack []int</span><br><span class="line">	<span class="keyword">for</span> i, <span class="attr">v</span> := range T &#123;</span><br><span class="line">		<span class="keyword">for</span> len(stack) &gt; <span class="number">0</span> &amp;&amp; v &gt; T[stack[len(stack)<span class="number">-1</span>]] &#123;</span><br><span class="line">			stackPopIndices := stack[len(stack)<span class="number">-1</span>]</span><br><span class="line">			ret[stackPopIndices] = i - stackPopIndices</span><br><span class="line">			stack = stack[:len(stack)<span class="number">-1</span>]</span><br><span class="line">		&#125;</span><br><span class="line">		stack = append(stack, i)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><p>这是一道很典型的利用单调栈特性的题目，感觉自己每次遇到单调栈题目时总是会卡住没有思路，留一个todo：总结一下单调栈和它的应用场景。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/08/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/08/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">排序算法总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-08 20:45:59" itemprop="dateCreated datePublished" datetime="2020-10-08T20:45:59+08:00">2020-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 11:29:32" itemprop="dateModified" datetime="2020-12-31T11:29:32+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>排序几乎是每个程序员算法的入门，在平时的工作中，排序几乎无处不在。熟练掌握各种排序算法的原理、时间/空间复杂度可以说是程序员重要的一项基本功，通常也是各个公司面试官非常喜爱考察的问题。<br>本文试图总结常见的排序算法原理、代码、时间/空间复杂度，以及这些算法应用的一些思考。</p>
<h1 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h1><p>一种典型分治思想的排序算法。其基本流程是</p>
<ul>
<li>取数组中的第一个元素（随机化快排随机选取数组中的一个节点）</li>
<li>遍历数组，将小于该元素值的元素置于该元素左侧，其他元素置于该元素右侧</li>
<li>递归对左右侧子数组进行相同处理<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">void</span> quicksort(int[] a, int begin, int end) &#123;</span><br><span class="line">    <span class="keyword">if</span> (begin &gt;= end) <span class="keyword">return</span>;</span><br><span class="line">    int temp = a[begin];</span><br><span class="line">    int key = begin;</span><br><span class="line">    <span class="keyword">for</span> (int j = begin + <span class="number">1</span>; j &lt;= end; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[j] &lt; temp) &#123;</span><br><span class="line">            swap(a, key + <span class="number">1</span>, j);</span><br><span class="line">            key++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    swap(a, begin, key);</span><br><span class="line">    quicksort(a, begin, key - <span class="number">1</span>);</span><br><span class="line">    quicksort(a, key + <span class="number">1</span>, end);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="快速排序的时间复杂度"><a href="#快速排序的时间复杂度" class="headerlink" title="快速排序的时间复杂度"></a>快速排序的时间复杂度</h2>理想状态下，每个选择出来的元素刚好能将数组切分成大小相同的两个子数组，那么递推公式就是：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(n) = <span class="number">2</span> * T(n/<span class="number">2</span>) + n</span><br></pre></td></tr></table></figure>
推导可得时间复杂度为O(n$\log(n)$)，但在最糟糕的情况，即数组本身就是有序的情况下，会退化成O($n^{2}$)，但是这种情况可以通过随机化快排的方式来进行规避，但在实际情况中，这种极端情况极少出现，同时也可以采用随机化的方式来进行规避，因此快速排序可以说是一个非常优秀的排序算法。（其实，只要是非极端情况，如选中的元素将数组切分成1:9两部分，那快速排序的时间复杂度依然是O(n$\log(n)$)）<h2 id="快速排序是否是稳定排序？"><a href="#快速排序是否是稳定排序？" class="headerlink" title="快速排序是否是稳定排序？"></a>快速排序是否是稳定排序？</h2>显然不是，快速排序是随机选中数组中的一个元素，考虑这样一个数组{1,2,3,9,8,11,8}，选中最后一个8作为比对元素，那么这个8会被放置在索引3的位置，这样就和索引4的8的前后顺序发生了变更。<h2 id="快速排序的空间复杂度"><a href="#快速排序的空间复杂度" class="headerlink" title="快速排序的空间复杂度"></a>快速排序的空间复杂度</h2>快排是一种原地排序算法，空间复杂度为O(1)。<h1 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h1>归并排序同样是利用分治思想的排序算法，其思想是：将数组从中间分成前后两部分，对两部分分别排序，再对两个有序数组进行合并排序，这样整个数组就是有序的了。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">void</span> mergesort(int[] a, int begin, int end) &#123;</span><br><span class="line">    <span class="keyword">if</span> (begin &gt;= end) <span class="keyword">return</span>;</span><br><span class="line">    int mid = (begin + end) / <span class="number">2</span>;</span><br><span class="line">    mergesort(a, begin, mid);</span><br><span class="line">    mergesort(a, mid + <span class="number">1</span>, end);</span><br><span class="line">    merge(a, begin, mid, end);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">void</span> merge(int[] a, int begin, int mid, int end) &#123;</span><br><span class="line">    int[] temp = <span class="keyword">new</span> int[end - begin + <span class="number">1</span>];</span><br><span class="line">    int i = begin, j = mid + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= end) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt; a[j]) &#123;</span><br><span class="line">            temp[k++] = a[i++];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            temp[k++] = a[j++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) &#123;</span><br><span class="line">        temp[k++] = a[i++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= end) &#123;</span><br><span class="line">        temp[k++] = a[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (int m = <span class="number">0</span>; m &lt; temp.length; m++) &#123;</span><br><span class="line">        a[m + begin] = temp[m];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="归并排序的时间复杂度"><a href="#归并排序的时间复杂度" class="headerlink" title="归并排序的时间复杂度"></a>归并排序的时间复杂度</h2>与快速排序类似的，归并排序的时间复杂度可以由以下递推公式推得：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(n) = <span class="number">2</span> * T(n/<span class="number">2</span>) + n</span><br></pre></td></tr></table></figure>
即处理左右两个子数组的时间复杂度+合并两个子数组的时间，因此，归并排序的时间复杂度是O(n$\log(n)$)。<h2 id="归并排序是稳定排序么？"><a href="#归并排序是稳定排序么？" class="headerlink" title="归并排序是稳定排序么？"></a>归并排序是稳定排序么？</h2>我们在merge的过程中，只要保证先将左边数组的元素放入temp数组，就可以保证值相同的元素在排序后依然保持先后顺序不变，因此归并排序是稳定排序。<h2 id="归并排序的空间复杂度"><a href="#归并排序的空间复杂度" class="headerlink" title="归并排序的空间复杂度"></a>归并排序的空间复杂度</h2>归并排序需要借助一个temp数组来实现合并排序，虽然在递归过程中会申请很多临时数组，但在合并后，这个临时数组就被释放了，因此实际申请的最大空间也不会超过n个数据，空间复杂度为O(n)。<br>归并排序从时间复杂度来看，是一个非常优秀的排序算法，然而相比于快速排序和堆排序，归并排序在实际场景中很少被使用，个人认为主要原因是：</li>
<li>有额外的空间开销，排序100M的数据，额外占用100M空间</li>
<li>代码本身比较复杂，实际运行时不会十分高效 <h1 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h1>堆排序的思想是利用大（小）顶堆的性质来进行排序，首先将原数组构造成一个大顶堆，每次交换堆顶元素和尾部元素，再重新构建大顶堆。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">void</span> heapsort(int[] a)</span><br><span class="line">&#123;</span><br><span class="line">    int length=a.length;</span><br><span class="line">    <span class="keyword">for</span>(int i=(length<span class="number">-1</span>)/<span class="number">2</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        sink(a,i,length<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    int n=length<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        swap(a,n--,<span class="number">0</span>);</span><br><span class="line">        sink(a,<span class="number">0</span>,n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public <span class="keyword">void</span> sink(int[] a,int k,int n)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">2</span>*k+<span class="number">1</span>&lt;=n)</span><br><span class="line">    &#123;</span><br><span class="line">        int j=<span class="number">2</span>*k+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(j&lt;n&amp;&amp;a[j]&lt;a[j+<span class="number">1</span>])</span><br><span class="line">            j++;</span><br><span class="line">        <span class="keyword">if</span>(a[k]&gt;a[j]) <span class="keyword">break</span>;</span><br><span class="line">        swap(a,j,k);</span><br><span class="line">        k=j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="堆排序的时间复杂度"><a href="#堆排序的时间复杂度" class="headerlink" title="堆排序的时间复杂度"></a>堆排序的时间复杂度</h2><p>堆排序的流程可以分为两步：</p>
<ol>
<li>构建大顶堆</li>
<li>排序重建堆</li>
</ol>
<p>其中，初始化构建大顶堆的时间复杂度为O(n)，而排序堆重建每次重建的复杂度为O(logn)，因此时间复杂度为：<br>O(n)+O(n*logn) = O(nlogn)* ## 堆排序是稳定排序么？<br>显然不是，在构建大顶堆的时候，相等元素可能会调整顺序，因此堆排序不是一种稳定的排序。</p>
<h2 id="堆排序的空间复杂度"><a href="#堆排序的空间复杂度" class="headerlink" title="堆排序的空间复杂度"></a>堆排序的空间复杂度</h2><p>堆排序是一种原地排序，不需要额外的空间开销，空间复杂度为O(1)。<br>堆排序无论从空间还是时间性能来看，都是一种很优秀的排序算法，但是在实际生产环境中，堆排序的应用并不广泛。最重要的原因是现代CPU的高速缓存架构导致堆排序这种跳跃数组遍历的方式无法充分利用CPU高速缓存，因而在实际应用中通常性能并不如快速排序和插入排序。<br>未完待续….</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/06/MIT-6-824-2018-LAB1-MapReduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/06/MIT-6-824-2018-LAB1-MapReduce/" class="post-title-link" itemprop="url">MIT-6.824-2018-LAB1-MapReduce</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-06 12:30:16" itemprop="dateCreated datePublished" datetime="2020-06-06T12:30:16+08:00">2020-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 11:29:32" itemprop="dateModified" datetime="2020-12-31T11:29:32+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>6.824，MIT的神课之一，转Golang的机会正好作为一次练习。目前Lab1已经刷完，感觉还是很有收获，尤其是踩了些Go的坑，<a target="_blank" rel="noopener" href="https://github.com/victormeng24/6.824" title="Github地址">Github地址</a>。</p>
<h1 id="Part-I"><a href="#Part-I" class="headerlink" title="Part I"></a>Part I</h1><blockquote>
<p>The Map/Reduce implementation you are given is missing some pieces. Before you can write your first Map/Reduce function pair, you will need to fix the sequential implementation. In particular, the code we give you is missing two crucial pieces: the function that divides up the output of a map task, and the function that gathers all the inputs for a reduce task. These tasks are carried out by the doMap() function in common_map.go, and the doReduce() function in common_reduce.go respectively. The comments in those files should point you in the right direction.</p>
<p>To help you determine if you have correctly implemented doMap() and doReduce(), we have provided you with a Go test suite that checks the correctness of your implementation. These tests are implemented in the file test_test.go. To run the tests for the sequential implementation that you have now fixed, run:_</p>
</blockquote>
<p>PartI是对Map/Reduce function的一个简单实现（不是具体的Mr逻辑，而是对于文件操作的骨架实现），主要是帮助你熟悉Golang的一些对于文件IO的语法，整体没有太大难度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">func doMap(</span><br><span class="line">	jobName string, <span class="comment">// the name of the MapReduce job</span></span><br><span class="line">	mapTask int,    <span class="comment">// which map task this is</span></span><br><span class="line">	inFile string,</span><br><span class="line">	nReduce int, <span class="comment">// the number of reduce task that will be run (&quot;R&quot; in the paper)</span></span><br><span class="line">	mapF func(filename string, contents string) []KeyValue,</span><br><span class="line">) &#123;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// doMap manages one map task: it should read one of the input files</span></span><br><span class="line">	<span class="comment">// (inFile), call the user-defined map function (mapF) for that file&#x27;s</span></span><br><span class="line">	<span class="comment">// contents, and partition mapF&#x27;s output into nReduce intermediate files.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// There is one intermediate file per reduce task. The file name</span></span><br><span class="line">	<span class="comment">// includes both the map task number and the reduce task number. Use</span></span><br><span class="line">	<span class="comment">// the filename generated by reduceName(jobName, mapTask, r)</span></span><br><span class="line">	<span class="comment">// as the intermediate file for reduce task r. Call ihash() (see</span></span><br><span class="line">	<span class="comment">// below) on each key, mod nReduce, to pick r for a key/value pair.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// mapF() is the map function provided by the application. The first</span></span><br><span class="line">	<span class="comment">// argument should be the input file name, though the map function</span></span><br><span class="line">	<span class="comment">// typically ignores it. The second argument should be the entire</span></span><br><span class="line">	<span class="comment">// input file contents. mapF() returns a slice containing the</span></span><br><span class="line">	<span class="comment">// key/value pairs for reduce; see common.go for the definition of</span></span><br><span class="line">	<span class="comment">// KeyValue.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Look at Go&#x27;s ioutil and os packages for functions to read</span></span><br><span class="line">	<span class="comment">// and write files.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Coming up with a scheme for how to format the key/value pairs on</span></span><br><span class="line">	<span class="comment">// disk can be tricky, especially when taking into account that both</span></span><br><span class="line">	<span class="comment">// keys and values could contain newlines, quotes, and any other</span></span><br><span class="line">	<span class="comment">// character you can think of.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// One format often used for serializing data to a byte stream that the</span></span><br><span class="line">	<span class="comment">// other end can correctly reconstruct is JSON. You are not required to</span></span><br><span class="line">	<span class="comment">// use JSON, but as the output of the reduce tasks *must* be JSON,</span></span><br><span class="line">	<span class="comment">// familiarizing yourself with it here may prove useful. You can write</span></span><br><span class="line">	<span class="comment">// out a data structure as a JSON string to a file using the commented</span></span><br><span class="line">	<span class="comment">// code below. The corresponding decoding functions can be found in</span></span><br><span class="line">	<span class="comment">// common_reduce.go.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//   enc := json.NewEncoder(file)</span></span><br><span class="line">	<span class="comment">//   for _, kv := ... &#123;</span></span><br><span class="line">	<span class="comment">//     err := enc.Encode(&amp;kv)</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Remember to close the file after you have written all the values!</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Your code here (Part I).</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	content, <span class="attr">err</span> := ioutil.ReadFile(inFile)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	keyValue := mapF(inFile, string(content))</span><br><span class="line">	mapper := make([][]KeyValue, nReduce)</span><br><span class="line">	<span class="comment">// determine to which reducer</span></span><br><span class="line">	<span class="keyword">for</span> _, <span class="attr">v</span> := range keyValue &#123;</span><br><span class="line">		idx := ihash(v.Key) % nReduce</span><br><span class="line">		mapper[idx] = append(mapper[idx], v)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// write to target File</span></span><br><span class="line">	<span class="keyword">for</span> index, <span class="attr">v</span> := range mapper &#123;</span><br><span class="line">		targetFileName := reduceName(jobName, mapTask, index)</span><br><span class="line">		fileNameToChoose, <span class="attr">err</span> := os.Create(targetFileName)</span><br><span class="line">		<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">			panic(err)</span><br><span class="line">		&#125;</span><br><span class="line">		ret, <span class="attr">err</span> := json.Marshal(v)</span><br><span class="line">		<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">			panic(err)</span><br><span class="line">		&#125;</span><br><span class="line">		fileNameToChoose.Write(ret)</span><br><span class="line">		fileNameToChoose.Close()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">func doReduce(</span><br><span class="line">	jobName string, <span class="comment">// the name of the whole MapReduce job</span></span><br><span class="line">	reduceTask int, <span class="comment">// which reduce task this is</span></span><br><span class="line">	outFile string, <span class="comment">// write the output here</span></span><br><span class="line">	nMap int,       <span class="comment">// the number of map tasks that were run (&quot;M&quot; in the paper)</span></span><br><span class="line">	reduceF func(key string, values []string) string,</span><br><span class="line">) &#123;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// doReduce manages one reduce task: it should read the intermediate</span></span><br><span class="line">	<span class="comment">// files for the task, sort the intermediate key/value pairs by key,</span></span><br><span class="line">	<span class="comment">// call the user-defined reduce function (reduceF) for each key, and</span></span><br><span class="line">	<span class="comment">// write reduceF&#x27;s output to disk.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// You&#x27;ll need to read one intermediate file from each map task;</span></span><br><span class="line">	<span class="comment">// reduceName(jobName, m, reduceTask) yields the file</span></span><br><span class="line">	<span class="comment">// name from map task m.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Your doMap() encoded the key/value pairs in the intermediate</span></span><br><span class="line">	<span class="comment">// files, so you will need to decode them. If you used JSON, you can</span></span><br><span class="line">	<span class="comment">// read and decode by creating a decoder and repeatedly calling</span></span><br><span class="line">	<span class="comment">// .Decode(&amp;kv) on it until it returns an error.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// You may find the first example in the golang sort package</span></span><br><span class="line">	<span class="comment">// documentation useful.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// reduceF() is the application&#x27;s reduce function. You should</span></span><br><span class="line">	<span class="comment">// call it once per distinct key, with a slice of all the values</span></span><br><span class="line">	<span class="comment">// for that key. reduceF() returns the reduced value for that key.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// You should write the reduce output as JSON encoded KeyValue</span></span><br><span class="line">	<span class="comment">// objects to the file named outFile. We require you to use JSON</span></span><br><span class="line">	<span class="comment">// because that is what the merger than combines the output</span></span><br><span class="line">	<span class="comment">// from all the reduce tasks expects. There is nothing special about</span></span><br><span class="line">	<span class="comment">// JSON -- it is just the marshalling format we chose to use. Your</span></span><br><span class="line">	<span class="comment">// output code will look something like this:</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// enc := json.NewEncoder(file)</span></span><br><span class="line">	<span class="comment">// for key := ... &#123;</span></span><br><span class="line">	<span class="comment">// 	enc.Encode(KeyValue&#123;key, reduceF(...)&#125;)</span></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line">	<span class="comment">// file.Close()</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Your code here (Part I).</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	keyV := make(map[string][]string)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; nMap; i++ &#123;</span><br><span class="line">		mapFileName := reduceName(jobName, i, reduceTask)</span><br><span class="line">		input, <span class="attr">err</span> := ioutil.ReadFile(mapFileName)</span><br><span class="line">		<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">			panic(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> tmpKeyv []KeyValue</span><br><span class="line">		json.Unmarshal(input, &amp;tmpKeyv)</span><br><span class="line">		<span class="keyword">for</span> _, <span class="attr">v</span> := range tmpKeyv &#123;</span><br><span class="line">			keyV[v.Key] = append(keyV[v.Key], v.Value)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	outputFile, <span class="attr">err</span> := os.Create(outFile)</span><br><span class="line">	<span class="keyword">if</span> err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	enc := json.NewEncoder(outputFile)</span><br><span class="line">	<span class="keyword">for</span> key, <span class="attr">value</span> := range keyV &#123;</span><br><span class="line">		<span class="keyword">if</span> err := enc.Encode(KeyValue&#123;key, reduceF(key, value)&#125;); err != nil &#123;</span><br><span class="line">			panic(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := outputFile.Close(); err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Part-II"><a href="#Part-II" class="headerlink" title="Part II"></a>Part II</h1><blockquote>
<p>Now you will implement word count — a simple Map/Reduce example. Look in main/wc.go; you’ll find empty mapF() and reduceF() functions. Your job is to insert code so that wc.go reports the number of occurrences of each word in its input. A word is any contiguous sequence of letters, as determined by unicode.IsLetter.</p>
</blockquote>
<p>实现一个WordCount的mr function，其实也很简单，主要是熟悉一下Golang的api-&gt;如何将一篇文章拆分成string的slice？strings. FieldsFunc(s string, f func(rune) bool)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">func mapF(filename string, contents string) []mapreduce.KeyValue &#123;</span><br><span class="line">	<span class="comment">// Your code here (Part II).</span></span><br><span class="line">	strArr := strings.FieldsFunc(contents, func(r rune) bool &#123;</span><br><span class="line">		<span class="keyword">return</span> !unicode.IsLetter(r)</span><br><span class="line">	&#125;)</span><br><span class="line">	ret := make([]mapreduce.KeyValue, <span class="number">0</span>, len(strArr))</span><br><span class="line">	<span class="keyword">for</span> _, <span class="attr">str</span> := range strArr &#123;</span><br><span class="line">		kv := mapreduce.KeyValue&#123;<span class="attr">Key</span>: str, <span class="attr">Value</span>: <span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">		ret = append(ret, kv)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The reduce function is called once for each key generated by the</span></span><br><span class="line"><span class="comment">// map tasks, with a list of all the values created for that key by</span></span><br><span class="line"><span class="comment">// any map task.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">func reduceF(key string, values []string) string &#123;</span><br><span class="line">	<span class="comment">// Your code here (Part II).</span></span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%d&quot;</span>, len(values))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Part-III-amp-IV"><a href="#Part-III-amp-IV" class="headerlink" title="Part III&amp;IV"></a>Part III&amp;IV</h1><blockquote>
<p>Your current implementation runs the map and reduce tasks one at a time. One of Map/Reduce’s biggest selling points is that it can automatically parallelize ordinary sequential code without any extra work by the developer. In this part of the lab, you will complete a version of MapReduce that splits the work over a set of worker threads that run in parallel on multiple cores. While not distributed across multiple machines as in real Map/Reduce deployments, your implementation will use RPC to simulate distributed computation.<br>In this part you will make the master handle failed workers. MapReduce makes this relatively easy because workers don’t have persistent state. If a worker fails while handling an RPC from the master, the master’s call() will eventually return false due to a timeout. In that situation, the master should re-assign the task given to the failed worker to another worker.</p>
</blockquote>
<blockquote>
<p>An RPC failure doesn’t necessarily mean that the worker didn’t execute the task; the worker may have executed it but the reply was lost, or the worker may still be executing but the master’s RPC timed out. Thus, it may happen that two workers receive the same task, compute it, and generate output. Two invocations of a map or reduce function are required to generate the same output for a given input (i.e. the map and reduce functions are “functional”), so there won’t be inconsistencies if subsequent processing sometimes reads one output and sometimes the other. In addition, the MapReduce framework ensures that map and reduce function output appears atomically: the output file will either not exist, or will contain the entire output of a single execution of the map or reduce function (the lab code doesn’t actually implement this, but instead only fails workers at the end of a task, so there aren’t concurrent executions of a task).</p>
</blockquote>
<p>Part III和Part IV，如果你对Goroutine和Channel不是很了解的话，实现起来就有难度了。PartIII是实现一个Mr的分布式调度器schedule()，RPC通信的框架和Worker的DoTask课程都为我们实现了，我们需要考虑的就是Master节点如何调度Worker完成具体的作业，以及（PartIV）当Worker Failure了之后如何实现高可用（将分配给该Worker的任务重新分配给另一个Worker）。实现要求我们只改动schedule.go中的schedule() function：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">func schedule(jobName string, mapFiles []string, nReduce int, phase jobPhase, registerChan chan string) &#123;</span><br><span class="line">	<span class="keyword">var</span> ntasks int</span><br><span class="line">	<span class="keyword">var</span> n_other int <span class="comment">// number of inputs (for reduce) or outputs (for map)</span></span><br><span class="line">	<span class="keyword">switch</span> phase &#123;</span><br><span class="line">	<span class="keyword">case</span> mapPhase:</span><br><span class="line">		ntasks = len(mapFiles)</span><br><span class="line">		n_other = nReduce</span><br><span class="line">	<span class="keyword">case</span> reducePhase:</span><br><span class="line">		ntasks = nReduce</span><br><span class="line">		n_other = len(mapFiles)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Schedule: %v %v tasks (%d I/Os)\n&quot;</span>, ntasks, phase, n_other)</span><br><span class="line">	<span class="comment">// All ntasks tasks have to be scheduled on workers. Once all tasks</span></span><br><span class="line">	<span class="comment">// have completed successfully, schedule() should return.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Your code here (Part III, Part IV).</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; ntasks; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		args := &amp;DoTaskArgs&#123;</span><br><span class="line">			JobName:       jobName,</span><br><span class="line">			File:          mapFiles[i],</span><br><span class="line">			Phase:         phase,</span><br><span class="line">			TaskNumber:    i,</span><br><span class="line">			NumOtherPhase: n_other&#125;</span><br><span class="line">		go func(ch chan string, args *DoTaskArgs) &#123;</span><br><span class="line">			worker := <span class="xml"><span class="tag">&lt;<span class="name">-registerChan</span></span></span></span><br><span class="line"><span class="xml">			for !call(worker, &quot;Worker.DoTask&quot;, args, nil) &#123;</span></span><br><span class="line">				worker = &lt;-registerChan</span><br><span class="line">			&#125;</span><br><span class="line">			// start a goroutine to avoid block</span><br><span class="line">			go func() &#123;</span><br><span class="line">				registerChan &lt;- worker</span><br><span class="line">			&#125;()</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;(registerChan, args)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Printf(&quot;Schedule: %v done\n&quot;, phase)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>核心就是通过一个Channel对可用的Worker进行控制，调度任务时首先获取Worker，任务执行完毕后释放Worker。当Worker任务执行失败时重新选择一个可用的Worker。<br>需要注意的是任务执行完毕后为什么要启动另一个goroutine来释放worker呢？因为registerChan &lt;- worker是一个阻塞操作，当channel中有worker的时候会阻塞在这里导致主函数无法继续执行。</p>
<h1 id="Part-V"><a href="#Part-V" class="headerlink" title="Part V"></a>Part V</h1><blockquote>
<p>For this optional no-credit exercise, you will build Map and Reduce functions for generating an inverted index.</p>
<p>Inverted indices are widely used in computer science, and are particularly useful in document searching. Broadly speaking, an inverted index is a map from interesting facts about the underlying data, to the original location of that data. For example, in the context of search, it might be a map from keywords to documents that contain those words.</p>
<p>We have created a second binary in main/ii.go that is very similar to the wc.go you built earlier. You should modify mapF and reduceF in main/ii.go so that they together produce an inverted index. Running ii.go should output a list of tuples, one per line, in the following format:</p>
</blockquote>
<p>可选题，写的Challenge其实我觉得比3、4简单很多。。实现一个倒排索引，统计单词出现在几篇文章中以及这些文章的list，和PartII的逻辑基本没什么区别，加一个map实现去重即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The mapping function is called once for each piece of the input.</span></span><br><span class="line"><span class="comment">// In this framework, the key is the name of the file that is being processed,</span></span><br><span class="line"><span class="comment">// and the value is the file&#x27;s contents. The return value should be a slice of</span></span><br><span class="line"><span class="comment">// key/value pairs, each represented by a mapreduce.KeyValue.</span></span><br><span class="line">func mapF(<span class="built_in">document</span> string, value string) (res []mapreduce.KeyValue) &#123;</span><br><span class="line">	<span class="comment">// Your code here (Part V).</span></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		slice []string</span><br><span class="line">		mp    map[string]string</span><br><span class="line">		ret   []mapreduce.KeyValue</span><br><span class="line">	)</span><br><span class="line">	slice = strings.FieldsFunc(value, func(r rune) bool &#123;</span><br><span class="line">		<span class="keyword">return</span> !unicode.IsLetter(r)</span><br><span class="line">	&#125;)</span><br><span class="line">	mp = make(map[string]string)</span><br><span class="line">	<span class="keyword">for</span> _, <span class="attr">str</span> := range slice &#123;</span><br><span class="line">		<span class="keyword">if</span> _, <span class="attr">ok</span> := mp[str]; !ok &#123;</span><br><span class="line">			mp[str] = <span class="built_in">document</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ret = make([]mapreduce.KeyValue, <span class="number">0</span>, len(mp))</span><br><span class="line">	<span class="keyword">for</span> k, <span class="attr">v</span> := range mp &#123;</span><br><span class="line">		ret  = append(ret, mapreduce.KeyValue&#123;<span class="attr">Key</span>: k, <span class="attr">Value</span>: v&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The reduce function is called once for each key generated by Map, with a</span></span><br><span class="line"><span class="comment">// list of that key&#x27;s string value (merged across all inputs). The return value</span></span><br><span class="line"><span class="comment">// should be a single output value for that key.</span></span><br><span class="line">func reduceF(key string, values []string) string &#123;</span><br><span class="line">	<span class="comment">// Your code here (Part V).</span></span><br><span class="line">	sort.Strings(values)</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%v %v&quot;</span>, len(values), strings.Join(values, <span class="string">&quot;,&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/02/notify-%E4%B8%8EnotifyAll/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/02/notify-%E4%B8%8EnotifyAll/" class="post-title-link" itemprop="url">notify()与notifyAll()</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-02 14:54:58" itemprop="dateCreated datePublished" datetime="2020-06-02T14:54:58+08:00">2020-06-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 11:29:32" itemprop="dateModified" datetime="2020-12-31T11:29:32+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>谈notify()与notifyAll()之前，需要明确锁池和等待池两个概念：<br>锁池:假设线程A已经拥有了某个对象(注意:不是类)的锁，而其它的线程想要调用这个对象的某个synchronized方法(或者synchronized块)，由于这些线程在进入对象的synchronized方法之前必须先获得该对象的锁的拥有权，但是该对象的锁目前正被线程A拥有，所以这些线程就进入了该对象的锁池中。<br>等待池:假设一个线程A调用了某个对象的wait()方法，线程A就会释放该对象的锁后，进入到了该对象的等待池中</p>
<ul>
<li>当一个线程调用wait()时，代表让出持有的对象锁，同时自身进入等待池，处于等待池的线程不会去竞争对象锁</li>
<li>当一个线程调用notify()或者notifyAll()时，前者会从等待池中随机选择一个线程进入锁池来竞争对象锁，而后者会将等待池中的全部线程放入锁池中，这就是notify()和notifyAll()的区别</li>
<li>从notify()和notifyAll()的作用来看，理想状态下，竞争锁的线程应当具有相同的职能，否则会造成无用的开销甚至死锁（一个典型的死锁场景会在后面介绍）。如果需要对不同角色的线程进行类似wait&amp;notify的控制，可以使用Lock&amp;Condition来实现<br>关于nofify()产生死锁的场景，可以想象一个典型的多生产者消费者的场景：<br>生产者、消费者数量都为2，缓冲区为1，当按照下列并发顺序执行的时候出现死锁：</li>
</ul>
<p>1.消费者1获得锁，发现缓冲区为0，wait（wait自动释放锁）（等待池：消费者1 锁池：消费者2、生产者1、生产者2）<br>2.消费者2获得锁，发现缓冲区为0，wait（wait自动释放锁）（等待池：消费者1、消费者2  锁池：生产者1、生产者2）<br>3.生产者1获得锁，发现缓冲区为0可以生产，生产以后放在缓冲区，notify，现在缓冲区为1（等待池：消费者1、消费者2  锁池：生产者2）<br>4.第3步notify唤醒了消费者1，但是消费者1没有抢到锁，锁被生产者2拿到了；（等待池：消费者2  锁池：消费者1）<br>5.生产者2发现缓冲区为1（因为只是唤醒了消费者1，但是消费者1没有抢到锁，没法消费），wait（wait自动释放锁）；（等待池：消费者2 、生产者2 锁池：消费者1）<br>6.消费者1获得了锁，消费并且notify（此时生产者2和消费者2都处于wait状态），缓冲区为0；（等待池：消费者2 、生产者2 锁池：）<br>7.notify唤醒了消费者2，消费者2醒来后拿到锁发现缓冲区为0，接着wait，与此同时，生产者2也在wait，死锁产生。<br>造成这种情况的原因是：</p>
<ol>
<li>被notify()的线程不能保证持有锁</li>
<li>notify()可能唤醒同一角色的线程</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/01/Golang%E7%9A%84%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/01/Golang%E7%9A%84%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">Golang的性能测试与性能分析工具（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-01 15:56:23" itemprop="dateCreated datePublished" datetime="2020-06-01T15:56:23+08:00">2020-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 11:29:32" itemprop="dateModified" datetime="2020-12-31T11:29:32+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>对pprof做个简单总结和演示</p>
<ol>
<li>可通过HTTP请求的方式，导入”net/http/pprof”，访问<a href="http://ip:port/debug/pprof/">http://ip:port/debug/pprof/</a></li>
<li>命令行方式，以cpu性能测试为例 go tool pprof <a href="http://ip:port/debug/pprof/profile?seconds=10，10s为单位进行采样。">http://ip:port/debug/pprof/profile?seconds=10，10s为单位进行采样。</a></li>
<li>可以通过代码嵌入的方式对代码块进行详细分析。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fi, <span class="attr">err</span> := os.Create(<span class="string">&quot;cpu.prof&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line"><span class="comment">// handle error</span></span><br><span class="line">&#125;</span><br><span class="line">pprof.StartCPUProfile(fi)</span><br><span class="line"><span class="comment">// your code </span></span><br><span class="line">pprof.StopCPUProfile()</span><br></pre></td></tr></table></figure></li>
<li>分析.prof文件的命令 go tool pprof prof filename.prof</li>
<li>go test也支持profile输出性能分析文件 go test -bench=flag -cpuprofile=file.prof</li>
</ol>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="HTTP请求采样"><a href="#HTTP请求采样" class="headerlink" title="HTTP请求采样"></a>HTTP请求采样</h2><p>用简单的make slice方式来进行一下性能分析，代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/julienschmidt/httprouter&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	_ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func Index(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">	fmt.Fprint(w, <span class="string">&quot;Welcome!\n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func LoopSlice(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">	<span class="keyword">var</span> fbs []int</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">		fbs = MakeSlice(<span class="number">100</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	w.Write([]byte(fmt.Sprintf(<span class="string">&quot;%v&quot;</span>, fbs)))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func MakeSlice(n int) []int &#123;</span><br><span class="line">	<span class="keyword">var</span> ret []int</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		ret = append(ret, i)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, Index)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/loop&quot;</span>, LoopSlice)</span><br><span class="line">	log.Fatal(http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, nil))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动Server后，我们运行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof http:<span class="comment">//localhost:8080/debug/pprof/profile\?seconds\=10</span></span><br></pre></td></tr></table></figure>
<p>进行采样，简单对localhost:8080/loop进行几次模拟请求，得到采样结果：<br><img src="https://myblog-1259548259.cos.ap-beijing.myqcloud.com/pprof_cpu_sample.png"><br>可以看到cpu时间集中在append上（slice扩容）</p>
<h2 id="Benchmark输出输出prof结果"><a href="#Benchmark输出输出prof结果" class="headerlink" title="Benchmark输出输出prof结果"></a>Benchmark输出输出prof结果</h2><p>我们换一种方式，采用benchmark输出prof来进行性能分析，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line">func BenchmarkRequest(b *testing.B) &#123;</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	<span class="keyword">var</span> _ []int</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">		_ = MakeSlice(<span class="number">100000</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	b.StopTimer()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func MakeSlices(n int) []int &#123;</span><br><span class="line">	<span class="keyword">var</span> slice []int</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">		slice = append(slice, i)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> slice</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行 go test -bench=. -memprofile=mem.prof 将结果输出到men.prof文件中，用 go tool pprof mem.prof 分析 mem.prof<br>￼<img src="https://myblog-1259548259.cos.ap-beijing.myqcloud.com/pprof_mem_sample.png"><br>可以看到append对于内存的消耗</p>
<h2 id="一个有趣的问题"><a href="#一个有趣的问题" class="headerlink" title="一个有趣的问题"></a>一个有趣的问题</h2><p>我们对Go中的RWMutex（读写锁）的读锁进行性能测试，代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">func init() &#123;</span><br><span class="line">	m = make(map[string]string)</span><br><span class="line">	m[<span class="string">&quot;a&quot;</span>] = <span class="string">&quot;a&quot;</span></span><br><span class="line">	m[<span class="string">&quot;b&quot;</span>] = <span class="string">&quot;b&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func LockFreeAccess() &#123;</span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">	wg.Add(NumberReaders)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NumberReaders; i++ &#123;</span><br><span class="line">		go func() &#123;</span><br><span class="line">			<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; ReadTimes; j++ &#123;</span><br><span class="line">				_, <span class="attr">ok</span> := m[<span class="string">&quot;a&quot;</span>]</span><br><span class="line">				<span class="keyword">if</span> !ok &#123;</span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func LockAccess() &#123;</span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">	wg.Add(NumberReaders)</span><br><span class="line">	rwLock := sync.RWMutex&#123;&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NumberReaders; i++ &#123;</span><br><span class="line">		go func() &#123;</span><br><span class="line">			<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; ReadTimes; j++ &#123;</span><br><span class="line">				rwLock.RLock()</span><br><span class="line">				_, <span class="attr">ok</span> := m[<span class="string">&quot;a&quot;</span>]</span><br><span class="line">				<span class="keyword">if</span> !ok &#123;</span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line">				rwLock.RUnlock()</span><br><span class="line">			&#125;</span><br><span class="line">			wg.Done()</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func BenchmarkLockFree(b *testing.B) &#123;</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">		LockFreeAccess()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func BenchmarkLock(b *testing.B) &#123;</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">		LockAccess()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先进行Benchmark，得到的结果<br><img src="https://myblog-1259548259.cos.ap-beijing.myqcloud.com/rwmutex_bench.png"><br>即使读锁之前并不存在互斥，加了读锁的多协程并发性能并不好，将bench的cpu测试输出到cpu.prof，分析结果如下<br><img src="https://myblog-1259548259.cos.ap-beijing.myqcloud.com/rwmutex_cpuprof.png"><br>RWMutex的Rlock和Runlock占用的cpu时间极长。因此，读锁的不互斥并不代表着加了读锁之后的并发读性能会不受影响。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/01/Golang%E7%9A%84%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/01/Golang%E7%9A%84%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">Golang的性能测试与性能分析工具（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-01 13:24:44" itemprop="dateCreated datePublished" datetime="2020-06-01T13:24:44+08:00">2020-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 11:29:32" itemprop="dateModified" datetime="2020-12-31T11:29:32+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func BenchmarkStrAdd(b *testing.B)</span><br></pre></td></tr></table></figure>
<p>被称为golang的基准测试，定义了以Benchmark开头的function后，通过”go test -bench FLAG”命令<br>多个基准测试将按照顺序进行执行。<br>testing.B中封装了Benchmark中常用的方法调用。</p>
<h2 id="ResetTimer"><a href="#ResetTimer" class="headerlink" title="ResetTimer"></a>ResetTimer</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ResetTimer zeroes the elapsed benchmark time and memory allocation counters</span></span><br><span class="line"><span class="comment">// and deletes user-reported metrics.</span></span><br><span class="line"><span class="comment">// It does not affect whether the timer is running.</span></span><br><span class="line">func (b *B) ResetTimer()</span><br></pre></td></tr></table></figure>
<h2 id="StopTimer"><a href="#StopTimer" class="headerlink" title="StopTimer"></a>StopTimer</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StopTimer stops timing a test. This can be used to pause the timer</span></span><br><span class="line"><span class="comment">// while performing complex initialization that you don&#x27;t</span></span><br><span class="line"><span class="comment">// want to measure.</span></span><br><span class="line">func (b *B) StopTimer()</span><br></pre></td></tr></table></figure>
<h2 id="ReportAllocs"><a href="#ReportAllocs" class="headerlink" title="ReportAllocs"></a>ReportAllocs</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReportAllocs enables malloc statistics for this benchmark.</span></span><br><span class="line"><span class="comment">// It is equivalent to setting -test.benchmem, but it only affects the</span></span><br><span class="line"><span class="comment">// benchmark function that calls ReportAllocs.</span></span><br><span class="line">func (b *B) ReportAllocs()</span><br></pre></td></tr></table></figure>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>以字符串拼接为例，我们对比StringConcat、BytesBuffer和StringBuilder字符串拼接的性能，代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">	<span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func BenchmarkStrAdd(b *testing.B) &#123;</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; b.N; j++ &#123;</span><br><span class="line">		ret := <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">			ret += strconv.Itoa(i)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	b.ReportAllocs()</span><br><span class="line">	b.StopTimer()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func BenchmarkByteBuffer(b *testing.B) &#123;</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; b.N; j++ &#123;</span><br><span class="line">		ret := bytes.Buffer&#123;&#125;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">			ret.WriteString(strconv.Itoa(i))</span><br><span class="line">		&#125;</span><br><span class="line">		_ = ret.String()</span><br><span class="line">	&#125;</span><br><span class="line">	b.StopTimer()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func BenchmarkStringBuilder(b *testing.B) &#123;</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; b.N; j++ &#123;</span><br><span class="line">		ret := strings.Builder&#123;&#125;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">			ret.WriteString(strconv.Itoa(i))</span><br><span class="line">		&#125;</span><br><span class="line">		_ = ret.String()</span><br><span class="line">	&#125;</span><br><span class="line">	b.StopTimer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行代码 go test -bench . 结果如下<br><img src="https://myblog-1259548259.cos.ap-beijing.myqcloud.com/go_benchmark.png"><br>可以看到StringBuilder的性能略好于BytesBuffer，两者远好于StringConcat，我们还可以通过-benchmem查看内存的Benchmark<br><img src="https://myblog-1259548259.cos.ap-beijing.myqcloud.com/go_benchmark_mem.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/03/04/Leetcode-Go-26&27-RemoveDuplicates&Elements/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/04/Leetcode-Go-26&27-RemoveDuplicates&Elements/" class="post-title-link" itemprop="url">Leetcode-Go-26&27-Remove-Duplicates&Elements</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-04 14:41:22" itemprop="dateCreated datePublished" datetime="2020-03-04T14:41:22+08:00">2020-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 12:21:54" itemprop="dateModified" datetime="2020-12-31T12:21:54+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="26-Remove-Duplicates-in-Sorted-Array"><a href="#26-Remove-Duplicates-in-Sorted-Array" class="headerlink" title="26-Remove Duplicates in Sorted Array"></a>26-Remove Duplicates in Sorted Array</h1><p>给定一个排序数组，你需要在原地删除重复出现的元素，使得每个元素只出现一次，返回移除后数组的新长度。</p>
<p>不要使用额外的数组空间，你必须在原地修改输入数组并在使用 O(1) 额外空间的条件下完成。</p>
<p>示例 1:</p>
<p>给定数组 nums = <a href="">1,1,2</a>, </p>
<p>函数应该返回新的长度 2, 并且原数组 nums 的前两个元素被修改为 1, 2。 </p>
<p>你不需要考虑数组中超出新长度后面的元素。<br>示例 2:</p>
<p>给定 nums = <a href="">0,0,1,1,1,2,2,3,3,4</a>,</p>
<p>函数应该返回新的长度 5, 并且原数组 nums 的前五个元素被修改为 0, 1, 2, 3, 4。</p>
<p>你不需要考虑数组中超出新长度后面的元素。</p>
<p>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array">https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
<p>思路：快慢指针，慢指针用于保存新数组的长度，快指针遍历整个数组，当快慢指针相等时快指针跳过，表示遇到重复元素，不等时，交换快指针索引与慢指针索引+1的值，最后的前i+1项即为去重后的数组元素。<br>自己写了个实现，又看了下解题圈子里的实现，感觉自己的代码还是不够优雅，需要继续努力。<br>自己代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">func removeDuplicates(nums []int) int &#123;</span><br><span class="line">	<span class="keyword">if</span> len(nums) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">	i, <span class="attr">j</span> := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> ; i&lt;len(nums) <span class="number">-1</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">for</span> j &lt; len(nums) &amp;&amp; nums[i] == nums[j] &#123;</span><br><span class="line">			j++</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> j == len(nums) &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		nums[i+<span class="number">1</span>] = nums[j]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>题解代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func removeDuplicates(nums []int) int &#123;</span><br><span class="line">	<span class="keyword">if</span> len(nums) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">	i, <span class="attr">j</span> := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> ; j &lt; len(nums); j++ &#123;</span><br><span class="line">		<span class="keyword">if</span> nums[i] != nums[j] &#123;</span><br><span class="line">			i++</span><br><span class="line">			nums[i] = nums[j]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> i + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不过有趣的是上面我写的代码平均执行时间是8ms左右，下面这个代码要18ms左右，不太了解编译器对上面两种代码是如何进行优化的，后面有机会可以深入了解下。</p>
<h1 id="27-Remove-Elements"><a href="#27-Remove-Elements" class="headerlink" title="27-Remove Elements"></a>27-Remove Elements</h1><p>给定一个数组 nums 和一个值 val，你需要原地移除所有数值等于 val 的元素，返回移除后数组的新长度。</p>
<p>不要使用额外的数组空间，你必须在原地修改输入数组并在使用 O(1) 额外空间的条件下完成。</p>
<p>元素的顺序可以改变。你不需要考虑数组中超出新长度后面的元素。</p>
<p>示例 1:</p>
<p>给定 nums = <a href="">3,2,2,3</a>, val = 3,</p>
<p>函数应该返回新的长度 2, 并且 nums 中的前两个元素均为 2。</p>
<p>你不需要考虑数组中超出新长度后面的元素。<br>示例 2:</p>
<p>给定 nums = <a href="">0,1,2,2,3,0,4,2</a>, val = 2,</p>
<p>函数应该返回新的长度 5, 并且 nums 中的前五个元素为 0, 1, 3, 0, 4。</p>
<p>注意这五个元素可为任意顺序。</p>
<p>你不需要考虑数组中超出新长度后面的元素。</p>
<p>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/remove-element">https://leetcode-cn.com/problems/remove-element</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
<p>类似地，第27题基本也是相同的思路，只不过快指针指向指向数组尾部，当头指针发现元素等于目标值时，将其与尾指针指向元素交换，代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">func removeElement(nums []int, val int) int &#123;</span><br><span class="line">	<span class="keyword">if</span> len(nums) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">	i, <span class="attr">j</span> := <span class="number">0</span>, len(nums) - <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> i &lt;= j &#123;</span><br><span class="line">		<span class="keyword">if</span> nums[i] == val &#123;</span><br><span class="line">			nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">			j--</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			i++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> j + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/02/26/Leetcode-Go-Reverse-Integer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Roger Meng">
      <meta itemprop="description" content="一名理智的詹黑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="怒吃树的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/26/Leetcode-Go-Reverse-Integer/" class="post-title-link" itemprop="url">Leetcode-Go-7-Reverse-Integer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-26 13:40:02" itemprop="dateCreated datePublished" datetime="2020-02-26T13:40:02+08:00">2020-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 12:21:26" itemprop="dateModified" datetime="2020-12-31T12:21:26+08:00">2020-12-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>给出一个 32 位的有符号整数，你需要将这个整数中每位上的数字进行反转。</p>
<p>示例 1:</p>
<p>输入: 123<br>输出: 321<br> 示例 2:</p>
<p>输入: -123<br>输出: -321<br>示例 3:</p>
<p>输入: 120<br>输出: 21<br>注意:</p>
<p>假设我们的环境只能存储得下 32 位的有符号整数，则其数值范围为 <a href="">−231,  231 − 1</a>。请根据这个假设，如果反转后整数溢出那么就返回 0。</p>
<p>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reverse-integer">https://leetcode-cn.com/problems/reverse-integer</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
</blockquote>
<p>题目很简单，唯一需要注意的地方是边界值问题，int类型的数据在反转时可能溢出，借本道题了解下Go的testing包，上代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func reverse(x int) int &#123;</span><br><span class="line">	y := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> x != <span class="number">0</span> &#123;</span><br><span class="line">		y = y * <span class="number">10</span> + x % <span class="number">10</span></span><br><span class="line">		x = x / <span class="number">10</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> y &gt; <span class="number">1</span> &lt;&lt; <span class="number">31</span> <span class="number">-1</span>  || y &lt; -(<span class="number">1</span> &lt;&lt; <span class="number">31</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type question7 struct &#123;</span><br><span class="line">	para7</span><br><span class="line">	ans7</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// para 是参数</span></span><br><span class="line"><span class="comment">// one 代表第一个参数</span></span><br><span class="line">type para7 struct &#123;</span><br><span class="line">	one int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ans 是答案</span></span><br><span class="line"><span class="comment">// one 代表第一个答案</span></span><br><span class="line">type ans7 struct &#123;</span><br><span class="line">	one int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func Test_Problem7(t *testing.T) &#123;</span><br><span class="line"></span><br><span class="line">	qs := []question7&#123;</span><br><span class="line"></span><br><span class="line">		question7&#123;</span><br><span class="line">			para7&#123;<span class="number">321</span>&#125;,</span><br><span class="line">			ans7&#123;<span class="number">123</span>&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">		question7&#123;</span><br><span class="line">			para7&#123;<span class="number">-123</span>&#125;,</span><br><span class="line">			ans7&#123;<span class="number">-321</span>&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">		question7&#123;</span><br><span class="line">			para7&#123;<span class="number">120</span>&#125;,</span><br><span class="line">			ans7&#123;<span class="number">21</span>&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">		question7&#123;</span><br><span class="line">			para7&#123;<span class="number">1534236469</span>&#125;,</span><br><span class="line">			ans7&#123;<span class="number">0</span>&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;------------------------Leetcode Problem 7------------------------\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, <span class="attr">q</span> := range qs &#123;</span><br><span class="line">		ans, <span class="attr">p</span> := q.ans7, q.para7</span><br><span class="line">		fmt.Printf(<span class="string">&quot;【input】:%v    【output】:%v    [expectoutput]:%v\n&quot;</span>, p.one, reverse(p.one), ans.one)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;\n\n\n&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>testing参考的git上这个项目：<a target="_blank" rel="noopener" href="https://github.com/halfrost/LeetCode-Go">https://github.com/halfrost/LeetCode-Go</a>，对Go和力扣有兴趣的也可以看这个项目，带解析和测试用例。<br>目前对Go的测试有些简单了解：</p>
<ul>
<li>文件名以_test.go结尾_</li>
<li>引入testing包，是Go的基础测试工具</li>
<li>运行go test，编译执行当前目录下所有test.go测试文件</li>
<li>函数名以Test开头，如果是benchmark以Benchmark开头</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Roger Meng</p>
  <div class="site-description" itemprop="description">一名理智的詹黑</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Roger Meng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
